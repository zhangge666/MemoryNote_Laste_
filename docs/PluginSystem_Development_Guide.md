# MemoryNote æ’ä»¶ç³»ç»Ÿå¼€å‘æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

MemoryNoteæ’ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªå¼ºå¤§è€Œçµæ´»çš„æ‰©å±•æ¶æ„ï¼Œå…è®¸ç¬¬ä¸‰æ–¹å¼€å‘è€…é€šè¿‡æ’ä»¶æ¥æ‰©å±•åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½ã€‚æ’ä»¶ç³»ç»Ÿé‡‡ç”¨åŸºäºäº‹ä»¶é©±åŠ¨çš„é’©å­æ¶æ„ï¼Œæä¾›ä¸°å¯Œçš„APIæ¥å£ï¼Œæ”¯æŒUIæ‰©å±•ã€åŠŸèƒ½å¢å¼ºã€ç®—æ³•æ›¿æ¢ç­‰å¤šç§æ‰©å±•æ–¹å¼ã€‚

---

## ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           MemoryNote æ’ä»¶ç³»ç»Ÿæ¶æ„                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åº”ç”¨å±‚ (Application Layer)                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  ç¼–è¾‘å™¨     â”‚ â”‚  ä¾§è¾¹æ      â”‚ â”‚  å¤ä¹ ç³»ç»Ÿ   â”‚ â”‚  è®¾ç½®é¢æ¿   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ’ä»¶æ¥å£å±‚ (Plugin Interface Layer)                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  UIæ‰©å±•API  â”‚ â”‚  æ•°æ®API    â”‚ â”‚  ç®—æ³•API    â”‚ â”‚  ç³»ç»ŸAPI    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ’ä»¶ç®¡ç†å±‚ (Plugin Management Layer)                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  æ’ä»¶åŠ è½½å™¨ â”‚ â”‚  ç”Ÿå‘½å‘¨æœŸ   â”‚ â”‚  é’©å­ç³»ç»Ÿ   â”‚ â”‚  ä¾èµ–ç®¡ç†   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ’ä»¶æ²™ç®±å±‚ (Plugin Sandbox Layer)                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  æƒé™æ§åˆ¶   â”‚ â”‚  èµ„æºéš”ç¦»   â”‚ â”‚  é”™è¯¯éš”ç¦»   â”‚ â”‚  å®‰å…¨æ£€æŸ¥   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ’ä»¶è¿è¡Œæ—¶ (Plugin Runtime)                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æ’ä»¶A       æ’ä»¶B       æ’ä»¶C       æ’ä»¶D       æ’ä»¶E                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚ â”‚
â”‚  â”‚  â”‚UIæ‰©å±•   â”‚ â”‚Diffç®—æ³• â”‚ â”‚å¤ä¹ ç®—æ³• â”‚ â”‚å¿«æ·é”®   â”‚ â”‚ä¸»é¢˜æ‰©å±•     â”‚           â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶è¯´æ˜

#### 1. æ’ä»¶ç®¡ç†å™¨ (PluginManager)
- **èŒè´£**: æ’ä»¶çš„åŠ è½½ã€å¸è½½ã€å¯ç”¨ã€ç¦ç”¨
- **åŠŸèƒ½**: æ’ä»¶ä¾èµ–è§£æã€ç‰ˆæœ¬ç®¡ç†ã€å†²çªæ£€æµ‹
- **æ¥å£**: æ’ä»¶æ³¨å†Œã€æŸ¥è¯¢ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†

#### 2. é’©å­ç³»ç»Ÿ (Hook System)
- **èŒè´£**: äº‹ä»¶é©±åŠ¨çš„æ‰©å±•ç‚¹ç®¡ç†
- **åŠŸèƒ½**: é’©å­æ³¨å†Œã€è§¦å‘ã€ä¼˜å…ˆçº§æ§åˆ¶
- **æ¥å£**: åŒæ­¥/å¼‚æ­¥é’©å­ã€æ¡ä»¶é’©å­ã€ç®¡é“é’©å­

#### 3. API æ³¨å†Œä¸­å¿ƒ (API Registry)
- **èŒè´£**: æ’ä»¶APIçš„æ³¨å†Œå’Œå‘ç°
- **åŠŸèƒ½**: æ¥å£ç‰ˆæœ¬æ§åˆ¶ã€å…¼å®¹æ€§æ£€æŸ¥
- **æ¥å£**: APIæ³¨å†Œã€è°ƒç”¨ä»£ç†ã€æƒé™éªŒè¯

#### 4. æ²™ç®±ç¯å¢ƒ (Sandbox)
- **èŒè´£**: æ’ä»¶è¿è¡Œæ—¶çš„å®‰å…¨éš”ç¦»
- **åŠŸèƒ½**: èµ„æºè®¿é—®æ§åˆ¶ã€é”™è¯¯éš”ç¦»ã€æ€§èƒ½ç›‘æ§
- **æ¥å£**: å—é™çš„å…¨å±€å¯¹è±¡ã€å®‰å…¨çš„APIè®¿é—®

---

## æ’ä»¶ç”Ÿå‘½å‘¨æœŸ

### ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ

```typescript
enum PluginLifecycle {
  UNLOADED = 'unloaded',      // æœªåŠ è½½
  LOADING = 'loading',        // åŠ è½½ä¸­
  LOADED = 'loaded',          // å·²åŠ è½½
  INITIALIZING = 'initializing', // åˆå§‹åŒ–ä¸­
  ACTIVE = 'active',          // æ´»è·ƒçŠ¶æ€
  INACTIVE = 'inactive',      // éæ´»è·ƒçŠ¶æ€
  UNLOADING = 'unloading',    // å¸è½½ä¸­
  ERROR = 'error'             // é”™è¯¯çŠ¶æ€
}
```

### ç”Ÿå‘½å‘¨æœŸæµç¨‹

```mermaid
graph TD
    A[UNLOADED] --> B[LOADING]
    B --> C[LOADED]
    B --> H[ERROR]
    C --> D[INITIALIZING]
    C --> H
    D --> E[ACTIVE]
    D --> H
    E --> F[INACTIVE]
    F --> E
    E --> G[UNLOADING]
    F --> G
    G --> A
    G --> H
    H --> A
```

### ç”Ÿå‘½å‘¨æœŸé’©å­

```typescript
interface PluginLifecycleHooks {
  onLoad?(): Promise<void>           // æ’ä»¶åŠ è½½æ—¶
  onInitialize?(): Promise<void>     // æ’ä»¶åˆå§‹åŒ–æ—¶
  onActivate?(): Promise<void>       // æ’ä»¶æ¿€æ´»æ—¶
  onDeactivate?(): Promise<void>     // æ’ä»¶åœç”¨æ—¶
  onUnload?(): Promise<void>         // æ’ä»¶å¸è½½æ—¶
  onError?(error: Error): Promise<void> // æ’ä»¶å‡ºé”™æ—¶
  onUpdate?(oldVersion: string, newVersion: string): Promise<void> // æ’ä»¶æ›´æ–°æ—¶
}
```

---

## æ’ä»¶æ¥å£å®šä¹‰

### 1. åŸºç¡€æ’ä»¶æ¥å£

```typescript
// æ’ä»¶å…ƒä¿¡æ¯
interface PluginManifest {
  id: string                         // æ’ä»¶å”¯ä¸€æ ‡è¯†
  name: string                       // æ’ä»¶åç§°
  version: string                    // ç‰ˆæœ¬å· (è¯­ä¹‰åŒ–ç‰ˆæœ¬)
  description: string                // æ’ä»¶æè¿°
  author: string                     // ä½œè€…ä¿¡æ¯
  license: string                    // è®¸å¯è¯
  homepage?: string                  // ä¸»é¡µé“¾æ¥
  repository?: string                // ä»“åº“é“¾æ¥
  
  // ä¾èµ–å’Œå…¼å®¹æ€§
  engines: {
    memorynote: string               // æ”¯æŒçš„åº”ç”¨ç‰ˆæœ¬èŒƒå›´
  }
  dependencies?: Record<string, string> // æ’ä»¶ä¾èµ–
  peerDependencies?: Record<string, string> // åŒçº§ä¾èµ–
  
  // æ‰©å±•ç‚¹å£°æ˜
  contributes: {
    commands?: CommandContribution[]  // å‘½ä»¤è´¡çŒ®
    keybindings?: KeybindingContribution[] // å¿«æ·é”®è´¡çŒ®
    sidebar?: SidebarContribution[]   // ä¾§è¾¹æ è´¡çŒ®
    algorithms?: AlgorithmContribution[] // ç®—æ³•è´¡çŒ®
    themes?: ThemeContribution[]      // ä¸»é¢˜è´¡çŒ®
    languages?: LanguageContribution[] // è¯­è¨€è´¡çŒ®
  }
  
  // æƒé™å£°æ˜
  permissions: PluginPermission[]
  
  // æ’ä»¶é…ç½®æ¨¡å¼
  configurationSchema?: JSONSchema
}

// æ’ä»¶ä¸»ç±»æ¥å£
interface Plugin {
  readonly manifest: PluginManifest
  readonly context: PluginContext
  
  // ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
  onLoad?(): Promise<void>
  onInitialize?(): Promise<void>
  onActivate?(): Promise<void>
  onDeactivate?(): Promise<void>
  onUnload?(): Promise<void>
  onError?(error: Error): void
  
  // æ‰©å±•ç‚¹æ³¨å†Œ
  registerExtensions?(): void
}
```

### 2. æ’ä»¶ä¸Šä¸‹æ–‡æ¥å£

```typescript
interface PluginContext {
  // åŸºç¡€ä¿¡æ¯
  readonly pluginId: string
  readonly pluginPath: string
  readonly isDev: boolean
  
  // API è®¿é—®
  readonly api: PluginAPI
  readonly logger: PluginLogger
  readonly storage: PluginStorage
  readonly config: PluginConfig
  
  // äº‹ä»¶ç³»ç»Ÿ
  readonly events: PluginEventEmitter
  readonly hooks: PluginHookRegistry
  
  // èµ„æºç®¡ç†
  readonly disposables: DisposableRegistry
  
  // æ’ä»¶é—´é€šä¿¡
  readonly messaging: PluginMessaging
}
```

### 3. æ ¸å¿ƒAPIæ¥å£

```typescript
interface PluginAPI {
  // UI æ‰©å±•API
  ui: {
    // ä¾§è¾¹æ æ‰©å±•
    sidebar: {
      registerPanel(panel: SidebarPanel): Disposable
      updatePanel(id: string, updates: Partial<SidebarPanel>): void
      removePanel(id: string): void
      getPanel(id: string): SidebarPanel | undefined
    }
    
    // å¯¼èˆªæ æ‰©å±•
    navigation: {
      addButton(button: NavigationButton): Disposable
      removeButton(id: string): void
      updateButton(id: string, updates: Partial<NavigationButton>): void
    }
    
    // ç¼–è¾‘å™¨æ‰©å±•
    editor: {
      registerAction(action: EditorAction): Disposable
      registerDecorator(decorator: EditorDecorator): Disposable
      registerCompletionProvider(provider: CompletionProvider): Disposable
    }
    
    // å³é”®èœå•æ‰©å±•
    contextMenu: {
      registerMenuItem(item: ContextMenuItem): Disposable
      registerMenuGroup(group: ContextMenuGroup): Disposable
    }
    
    // çŠ¶æ€æ æ‰©å±•
    statusBar: {
      addItem(item: StatusBarItem): Disposable
      updateItem(id: string, updates: Partial<StatusBarItem>): void
      removeItem(id: string): void
    }
    
    // å¯¹è¯æ¡†å’Œé€šçŸ¥
    dialog: {
      showInformation(message: string, ...items: string[]): Promise<string | undefined>
      showWarning(message: string, ...items: string[]): Promise<string | undefined>
      showError(message: string, ...items: string[]): Promise<string | undefined>
      showInputBox(options: InputBoxOptions): Promise<string | undefined>
    }
    
    // è‡ªå®šä¹‰çª—å£
    window: {
      createWindow(options: WindowOptions): Promise<PluginWindow>
      getActiveWindow(): PluginWindow | undefined
      getAllWindows(): PluginWindow[]
    }
  }
  
  // æ•°æ®è®¿é—®API
  data: {
    // æ–‡ä»¶ç³»ç»Ÿ
    fs: {
      readFile(path: string): Promise<string>
      writeFile(path: string, content: string): Promise<void>
      exists(path: string): Promise<boolean>
      stat(path: string): Promise<FileStat>
      readdir(path: string): Promise<string[]>
      watch(path: string, callback: FileWatchCallback): Disposable
    }
    
    // æ•°æ®åº“è®¿é—®
    database: {
      notes: NotesAPI
      reviews: ReviewsAPI
      categories: CategoriesAPI
      settings: SettingsAPI
      custom: CustomDatabaseAPI
    }
    
    // å·®å¼‚ç®—æ³•API
    diff: {
      registerAlgorithm(algorithm: DiffAlgorithm): Disposable
      getDiffResult(oldContent: string, newContent: string, algorithmId?: string): DiffResult
      applyDiff(content: string, diff: DiffResult): string
    }
  }
  
  // å¤ä¹ ç³»ç»ŸAPI
  review: {
    // ç®—æ³•æ³¨å†Œ
    algorithms: {
      register(algorithm: ReviewAlgorithm): Disposable
      unregister(algorithmId: string): void
      getAlgorithm(algorithmId: string): ReviewAlgorithm | undefined
      listAlgorithms(): ReviewAlgorithm[]
    }
    
    // å¤ä¹ å¡ç‰‡ç®¡ç†
    cards: {
      create(card: Partial<ReviewCard>): Promise<ReviewCard>
      update(cardId: string, updates: Partial<ReviewCard>): Promise<void>
      delete(cardId: string): Promise<void>
      get(cardId: string): Promise<ReviewCard | undefined>
      list(filters?: ReviewCardFilters): Promise<ReviewCard[]>
    }
    
    // å¤ä¹ ä¼šè¯
    sessions: {
      start(options: ReviewSessionOptions): Promise<ReviewSession>
      end(sessionId: string): Promise<void>
      getCurrentSession(): ReviewSession | undefined
    }
  }
  
  // ç³»ç»ŸAPI
  system: {
    // å‘½ä»¤ç³»ç»Ÿ
    commands: {
      register(command: Command): Disposable
      execute(commandId: string, ...args: any[]): Promise<any>
      getCommand(commandId: string): Command | undefined
    }
    
    // å¿«æ·é”®ç³»ç»Ÿ
    keybindings: {
      register(keybinding: Keybinding): Disposable
      unregister(keybindingId: string): void
      updateKeybinding(keybindingId: string, newKey: string): void
    }
    
    // ä¸»é¢˜ç³»ç»Ÿ
    themes: {
      register(theme: Theme): Disposable
      apply(themeId: string): Promise<void>
      getCurrentTheme(): Theme | undefined
    }
    
    // é…ç½®ç³»ç»Ÿ
    configuration: {
      get<T>(key: string, defaultValue?: T): T
      set(key: string, value: any): Promise<void>
      onDidChange(callback: ConfigChangeCallback): Disposable
    }
    
    // å·¥ä½œåŒº
    workspace: {
      getPath(): string | undefined
      onDidChangeWorkspace(callback: WorkspaceChangeCallback): Disposable
      openFile(path: string): Promise<void>
      createFile(path: string, content?: string): Promise<void>
    }
  }
}
```

---

## æ‰©å±•ç‚¹è¯¦ç»†è®¾è®¡

### 1. ä¾§è¾¹æ æ‰©å±•

```typescript
// ä¾§è¾¹æ é¢æ¿å®šä¹‰
interface SidebarPanel {
  id: string                         // é¢æ¿å”¯ä¸€æ ‡è¯†
  title: string                      // é¢æ¿æ ‡é¢˜
  icon: string | VueComponent        // é¢æ¿å›¾æ ‡
  component: VueComponent            // é¢æ¿ç»„ä»¶
  position: number                   // æ˜¾ç¤ºä½ç½®æƒé‡
  when?: string                      // æ˜¾ç¤ºæ¡ä»¶è¡¨è¾¾å¼
  contextMenu?: ContextMenuItem[]    // å³é”®èœå•
  toolbar?: ToolbarItem[]            // å·¥å…·æ æŒ‰é’®
}

// ä¾§è¾¹æ é¢æ¿ç»„ä»¶æ¥å£
interface SidebarPanelComponent {
  // é¢æ¿æ¿€æ´»æ—¶è°ƒç”¨
  onActivate?(): void
  
  // é¢æ¿åœç”¨æ—¶è°ƒç”¨
  onDeactivate?(): void
  
  // é¢æ¿é”€æ¯æ—¶è°ƒç”¨
  onDestroy?(): void
  
  // é¢æ¿æ¥æ”¶ç„¦ç‚¹æ—¶è°ƒç”¨
  onFocus?(): void
  
  // é¢æ¿å¤±å»ç„¦ç‚¹æ—¶è°ƒç”¨
  onBlur?(): void
}

// ä½¿ç”¨ç¤ºä¾‹
class MyPlugin implements Plugin {
  onActivate() {
    // æ³¨å†Œä¾§è¾¹æ é¢æ¿
    this.context.api.ui.sidebar.registerPanel({
      id: 'my-plugin.sidebar-panel',
      title: 'æˆ‘çš„å·¥å…·',
      icon: 'ğŸ”§',
      component: MySidebarComponent,
      position: 100,
      when: 'workspaceOpen'
    })
  }
}
```

### 2. å¯¼èˆªæ æ‰©å±•

```typescript
// å¯¼èˆªæŒ‰é’®å®šä¹‰
interface NavigationButton {
  id: string                         // æŒ‰é’®å”¯ä¸€æ ‡è¯†
  label: string                      // æŒ‰é’®æ ‡ç­¾
  icon: string | VueComponent        // æŒ‰é’®å›¾æ ‡
  tooltip?: string                   // æ‚¬åœæç¤º
  position: number                   // æ˜¾ç¤ºä½ç½®æƒé‡
  command?: string                   // å…³è”å‘½ä»¤
  when?: string                      // æ˜¾ç¤ºæ¡ä»¶
  badge?: {                          // å¾½ç« æ˜¾ç¤º
    text: string
    color: string
  }
}

// ä½¿ç”¨ç¤ºä¾‹
this.context.api.ui.navigation.addButton({
  id: 'my-plugin.nav-button',
  label: 'æ’ä»¶åŠŸèƒ½',
  icon: 'âš¡',
  tooltip: 'ç‚¹å‡»æ‰“å¼€æ’ä»¶åŠŸèƒ½',
  position: 200,
  command: 'my-plugin.open-feature'
})
```

### 3. ç¼–è¾‘å™¨æ‰©å±•

```typescript
// ç¼–è¾‘å™¨æ“ä½œå®šä¹‰
interface EditorAction {
  id: string                         // æ“ä½œå”¯ä¸€æ ‡è¯†
  label: string                      // æ“ä½œæ ‡ç­¾
  description?: string               // æ“ä½œæè¿°
  keybinding?: string                // å¿«æ·é”®
  when?: string                      // è§¦å‘æ¡ä»¶
  handler: EditorActionHandler       // å¤„ç†å‡½æ•°
}

interface EditorActionHandler {
  (editor: Editor, selection: EditorSelection): Promise<void> | void
}

// ç¼–è¾‘å™¨è£…é¥°å™¨
interface EditorDecorator {
  id: string                         // è£…é¥°å™¨æ ‡è¯†
  matcher: TextMatcher               // æ–‡æœ¬åŒ¹é…å™¨
  decorator: DecorationRenderer      // è£…é¥°æ¸²æŸ“å™¨
  priority: number                   // ä¼˜å…ˆçº§
}

// è‡ªåŠ¨å®Œæˆæä¾›è€…
interface CompletionProvider {
  id: string                         // æä¾›è€…æ ‡è¯†
  triggerCharacters: string[]        // è§¦å‘å­—ç¬¦
  provider: CompletionItemProvider   // å®Œæˆé¡¹æä¾›è€…
}

// ä½¿ç”¨ç¤ºä¾‹
this.context.api.ui.editor.registerAction({
  id: 'my-plugin.format-text',
  label: 'æ ¼å¼åŒ–æ–‡æœ¬',
  keybinding: 'Ctrl+Shift+F',
  when: 'editorHasSelection',
  handler: async (editor, selection) => {
    const selectedText = editor.getSelectedText()
    const formattedText = await this.formatText(selectedText)
    editor.replaceSelection(formattedText)
  }
})
```

### 4. å·®å¼‚ç®—æ³•æ‰©å±•

```typescript
// å·®å¼‚ç®—æ³•æ¥å£
interface DiffAlgorithm {
  id: string                         // ç®—æ³•å”¯ä¸€æ ‡è¯†
  name: string                       // ç®—æ³•åç§°
  description: string                // ç®—æ³•æè¿°
  version: string                    // ç®—æ³•ç‰ˆæœ¬
  
  // è®¡ç®—å·®å¼‚
  computeDiff(oldContent: string, newContent: string, options?: DiffOptions): Promise<DiffResult>
  
  // åº”ç”¨å·®å¼‚
  applyDiff(content: string, diff: DiffResult): Promise<string>
  
  // ç®—æ³•é…ç½®
  getConfiguration(): DiffConfiguration
  setConfiguration(config: Partial<DiffConfiguration>): void
}

// å·®å¼‚ç»“æœå®šä¹‰
interface DiffResult {
  changes: DiffChange[]              // å˜æ›´åˆ—è¡¨
  metadata: {                        // å…ƒæ•°æ®
    algorithmId: string
    timestamp: number
    statistics: DiffStatistics
  }
}

interface DiffChange {
  type: 'insert' | 'delete' | 'modify' // å˜æ›´ç±»å‹
  position: TextPosition             // æ–‡æœ¬ä½ç½®
  oldText?: string                   // åŸæ–‡æœ¬
  newText?: string                   // æ–°æ–‡æœ¬
  confidence?: number                // ç½®ä¿¡åº¦
}

// ä½¿ç”¨ç¤ºä¾‹
class SemanticDiffAlgorithm implements DiffAlgorithm {
  id = 'semantic-diff'
  name = 'è¯­ä¹‰å·®å¼‚ç®—æ³•'
  description = 'åŸºäºè¯­ä¹‰åˆ†æçš„æ™ºèƒ½å·®å¼‚æ£€æµ‹'
  version = '1.0.0'
  
  async computeDiff(oldContent: string, newContent: string): Promise<DiffResult> {
    // å®ç°è¯­ä¹‰å·®å¼‚ç®—æ³•
    const changes = await this.analyzeSemanticChanges(oldContent, newContent)
    return {
      changes,
      metadata: {
        algorithmId: this.id,
        timestamp: Date.now(),
        statistics: this.calculateStatistics(changes)
      }
    }
  }
  
  // æ³¨å†Œç®—æ³•
  onActivate() {
    this.context.api.data.diff.registerAlgorithm(this)
  }
}
```

### 5. å¤ä¹ ç®—æ³•æ‰©å±•

```typescript
// å¤ä¹ ç®—æ³•æ¥å£
interface ReviewAlgorithm {
  id: string                         // ç®—æ³•å”¯ä¸€æ ‡è¯†
  name: string                       // ç®—æ³•åç§°
  description: string                // ç®—æ³•æè¿°
  version: string                    // ç®—æ³•ç‰ˆæœ¬
  
  // è®¡ç®—ä¸‹æ¬¡å¤ä¹ æ—¶é—´
  calculateNextReview(
    card: ReviewCard, 
    rating: ReviewRating, 
    context?: ReviewContext
  ): Promise<ReviewSchedule>
  
  // åˆå§‹åŒ–å¡ç‰‡å‚æ•°
  initializeCard(card: Partial<ReviewCard>): Promise<ReviewCard>
  
  // æ›´æ–°ç®—æ³•å‚æ•°
  updateParameters(card: ReviewCard, rating: ReviewRating): Promise<void>
  
  // è·å–ç®—æ³•ç»Ÿè®¡
  getStatistics(cards: ReviewCard[]): Promise<AlgorithmStatistics>
  
  // ç®—æ³•é…ç½®
  getConfiguration(): AlgorithmConfiguration
  setConfiguration(config: Partial<AlgorithmConfiguration>): void
}

// å¤ä¹ è°ƒåº¦ç»“æœ
interface ReviewSchedule {
  nextReviewDate: Date               // ä¸‹æ¬¡å¤ä¹ æ—¥æœŸ
  interval: number                   // å¤ä¹ é—´éš”(å¤©)
  easeFactor?: number                // éš¾åº¦å› å­
  confidence?: number                // ç®—æ³•ç½®ä¿¡åº¦
  metadata?: Record<string, any>     // ç®—æ³•ç‰¹å®šæ•°æ®
}

// ä½¿ç”¨ç¤ºä¾‹
class CustomSpacedRepetitionAlgorithm implements ReviewAlgorithm {
  id = 'custom-sr'
  name = 'è‡ªå®šä¹‰é—´éš”é‡å¤'
  description = 'æ”¹è¿›çš„é—´éš”é‡å¤ç®—æ³•'
  version = '1.0.0'
  
  async calculateNextReview(card: ReviewCard, rating: ReviewRating): Promise<ReviewSchedule> {
    // å®ç°è‡ªå®šä¹‰ç®—æ³•é€»è¾‘
    const interval = this.calculateInterval(card, rating)
    const nextDate = new Date()
    nextDate.setDate(nextDate.getDate() + interval)
    
    return {
      nextReviewDate: nextDate,
      interval,
      easeFactor: this.updateEaseFactor(card.easeFactor, rating),
      confidence: 0.95
    }
  }
  
  // æ³¨å†Œç®—æ³•
  onActivate() {
    this.context.api.review.algorithms.register(this)
  }
}
```

### 6. å¿«æ·é”®æ‰©å±•

```typescript
// å¿«æ·é”®å®šä¹‰
interface Keybinding {
  id: string                         // å¿«æ·é”®å”¯ä¸€æ ‡è¯†
  key: string                        // æŒ‰é”®ç»„åˆ
  command: string                    // å…³è”å‘½ä»¤
  when?: string                      // è§¦å‘æ¡ä»¶
  args?: any[]                       // å‘½ä»¤å‚æ•°
  priority?: number                  // ä¼˜å…ˆçº§
}

// å¿«æ·é”®ä¸Šä¸‹æ–‡
interface KeybindingContext {
  activeEditor: boolean              // ç¼–è¾‘å™¨æ¿€æ´»çŠ¶æ€
  editorHasSelection: boolean        // ç¼–è¾‘å™¨æœ‰é€‰ä¸­å†…å®¹
  sidebarVisible: boolean            // ä¾§è¾¹æ å¯è§çŠ¶æ€
  [key: string]: any                 // è‡ªå®šä¹‰ä¸Šä¸‹æ–‡
}

// ä½¿ç”¨ç¤ºä¾‹
this.context.api.system.keybindings.register({
  id: 'my-plugin.quick-action',
  key: 'Ctrl+Shift+Q',
  command: 'my-plugin.execute-quick-action',
  when: 'activeEditor && editorHasSelection'
})
```

### 7. è‡ªå®šä¹‰çª—å£æ‰©å±•

```typescript
// çª—å£é€‰é¡¹
interface WindowOptions {
  title: string                      // çª—å£æ ‡é¢˜
  width: number                      // çª—å£å®½åº¦
  height: number                     // çª—å£é«˜åº¦
  minWidth?: number                  // æœ€å°å®½åº¦
  minHeight?: number                 // æœ€å°é«˜åº¦
  resizable?: boolean                // æ˜¯å¦å¯è°ƒæ•´å¤§å°
  modal?: boolean                    // æ˜¯å¦ä¸ºæ¨¡æ€çª—å£
  parent?: PluginWindow              // çˆ¶çª—å£
  icon?: string                      // çª—å£å›¾æ ‡
  component: VueComponent            // çª—å£ç»„ä»¶
  props?: Record<string, any>        // ç»„ä»¶å±æ€§
}

// æ’ä»¶çª—å£æ¥å£
interface PluginWindow {
  readonly id: string                // çª—å£æ ‡è¯†
  readonly isDestroyed: boolean      // æ˜¯å¦å·²é”€æ¯
  
  // çª—å£æ§åˆ¶
  show(): void
  hide(): void
  close(): void
  minimize(): void
  maximize(): void
  restore(): void
  
  // çª—å£å±æ€§
  setTitle(title: string): void
  setSize(width: number, height: number): void
  setPosition(x: number, y: number): void
  
  // äº‹ä»¶ç›‘å¬
  onClosed(callback: () => void): Disposable
  onMoved(callback: (x: number, y: number) => void): Disposable
  onResized(callback: (width: number, height: number) => void): Disposable
  
  // ä¸çª—å£ç»„ä»¶é€šä¿¡
  sendMessage(message: any): void
  onMessage(callback: (message: any) => void): Disposable
}

// ä½¿ç”¨ç¤ºä¾‹
const window = await this.context.api.ui.window.createWindow({
  title: 'æ’ä»¶é…ç½®',
  width: 600,
  height: 400,
  resizable: true,
  component: PluginConfigComponent,
  props: {
    pluginId: this.context.pluginId
  }
})
```

---

## é’©å­ç³»ç»Ÿè®¾è®¡

### é’©å­ç±»å‹å®šä¹‰

```typescript
// é’©å­ç±»å‹æšä¸¾
enum HookType {
  // åº”ç”¨ç”Ÿå‘½å‘¨æœŸ
  APP_STARTING = 'app.starting',
  APP_READY = 'app.ready',
  APP_CLOSING = 'app.closing',
  
  // æ–‡ä»¶æ“ä½œ
  FILE_OPENING = 'file.opening',
  FILE_OPENED = 'file.opened',
  FILE_SAVING = 'file.saving',
  FILE_SAVED = 'file.saved',
  FILE_CLOSING = 'file.closing',
  FILE_CLOSED = 'file.closed',
  
  // ç¼–è¾‘å™¨
  EDITOR_CREATING = 'editor.creating',
  EDITOR_CREATED = 'editor.created',
  EDITOR_CONTENT_CHANGED = 'editor.contentChanged',
  EDITOR_SELECTION_CHANGED = 'editor.selectionChanged',
  EDITOR_DISPOSED = 'editor.disposed',
  
  // å¤ä¹ ç³»ç»Ÿ
  REVIEW_CARD_CREATING = 'review.cardCreating',
  REVIEW_CARD_CREATED = 'review.cardCreated',
  REVIEW_SESSION_STARTING = 'review.sessionStarting',
  REVIEW_SESSION_ENDING = 'review.sessionEnding',
  REVIEW_CARD_REVIEWING = 'review.cardReviewing',
  REVIEW_CARD_REVIEWED = 'review.cardReviewed',
  
  // å·®å¼‚æ£€æµ‹
  DIFF_COMPUTING = 'diff.computing',
  DIFF_COMPUTED = 'diff.computed',
  DIFF_APPLYING = 'diff.applying',
  DIFF_APPLIED = 'diff.applied',
  
  // UI äº‹ä»¶
  SIDEBAR_PANEL_OPENING = 'ui.sidebarPanelOpening',
  SIDEBAR_PANEL_OPENED = 'ui.sidebarPanelOpened',
  COMMAND_EXECUTING = 'ui.commandExecuting',
  COMMAND_EXECUTED = 'ui.commandExecuted'
}

// é’©å­å¤„ç†å™¨æ¥å£
interface HookHandler<T = any> {
  (context: HookContext<T>): Promise<void> | void
}

// é’©å­ä¸Šä¸‹æ–‡
interface HookContext<T = any> {
  readonly type: HookType            // é’©å­ç±»å‹
  readonly data: T                   // é’©å­æ•°æ®
  readonly source: string            // è§¦å‘æº
  readonly timestamp: number         // è§¦å‘æ—¶é—´
  
  // æ§åˆ¶æ–¹æ³•
  preventDefault(): void             // é˜»æ­¢é»˜è®¤è¡Œä¸º
  stopPropagation(): void           // åœæ­¢ä¼ æ’­
  
  // æ•°æ®ä¿®æ”¹(ä»…åŒæ­¥é’©å­)
  updateData(newData: Partial<T>): void
}

// é’©å­æ³¨å†Œé€‰é¡¹
interface HookRegistrationOptions {
  priority?: number                  // ä¼˜å…ˆçº§ (æ•°å­—è¶Šå°è¶Šæ—©æ‰§è¡Œ)
  once?: boolean                     // æ˜¯å¦åªæ‰§è¡Œä¸€æ¬¡
  condition?: (context: HookContext) => boolean // æ‰§è¡Œæ¡ä»¶
}
```

### é’©å­ä½¿ç”¨ç¤ºä¾‹

```typescript
class MyPlugin implements Plugin {
  onActivate() {
    // ç›‘å¬æ–‡ä»¶ä¿å­˜äº‹ä»¶
    this.context.hooks.on(HookType.FILE_SAVING, async (context) => {
      const { filePath, content } = context.data
      
      // åœ¨æ–‡ä»¶ä¿å­˜å‰è¿›è¡Œé¢„å¤„ç†
      if (filePath.endsWith('.md')) {
        const processedContent = await this.preprocessMarkdown(content)
        context.updateData({ content: processedContent })
      }
    }, { priority: 10 })
    
    // ç›‘å¬å¤ä¹ å¡ç‰‡åˆ›å»ºäº‹ä»¶
    this.context.hooks.on(HookType.REVIEW_CARD_CREATED, async (context) => {
      const { card } = context.data
      
      // è‡ªåŠ¨ä¸ºæ–°å¡ç‰‡æ·»åŠ æ ‡ç­¾
      await this.autoTagCard(card)
    })
    
    // ç›‘å¬å·®å¼‚è®¡ç®—äº‹ä»¶
    this.context.hooks.on(HookType.DIFF_COMPUTING, async (context) => {
      const { oldContent, newContent, algorithmId } = context.data
      
      // å¦‚æœæ²¡æœ‰æŒ‡å®šç®—æ³•ï¼Œä½¿ç”¨æ’ä»¶çš„ç®—æ³•
      if (!algorithmId) {
        context.updateData({ algorithmId: 'my-plugin.semantic-diff' })
      }
    })
  }
}
```

---

## æƒé™ç³»ç»Ÿè®¾è®¡

### æƒé™ç±»å‹å®šä¹‰

```typescript
// æƒé™ç±»å‹
enum PluginPermission {
  // æ–‡ä»¶ç³»ç»Ÿæƒé™
  FILE_READ = 'fs.read',               // è¯»å–æ–‡ä»¶
  FILE_WRITE = 'fs.write',             // å†™å…¥æ–‡ä»¶
  FILE_DELETE = 'fs.delete',           // åˆ é™¤æ–‡ä»¶
  FILE_WATCH = 'fs.watch',             // ç›‘å¬æ–‡ä»¶å˜åŒ–
  
  // æ•°æ®åº“æƒé™
  DB_READ = 'db.read',                 // è¯»å–æ•°æ®åº“
  DB_WRITE = 'db.write',               // å†™å…¥æ•°æ®åº“
  DB_SCHEMA = 'db.schema',             // ä¿®æ”¹æ•°æ®åº“ç»“æ„
  
  // ç½‘ç»œæƒé™
  NETWORK_REQUEST = 'network.request', // å‘èµ·ç½‘ç»œè¯·æ±‚
  NETWORK_LISTEN = 'network.listen',   // ç›‘å¬ç½‘ç»œç«¯å£
  
  // UIæƒé™
  UI_MODIFY = 'ui.modify',             // ä¿®æ”¹ç•Œé¢
  UI_DIALOG = 'ui.dialog',             // æ˜¾ç¤ºå¯¹è¯æ¡†
  UI_NOTIFICATION = 'ui.notification', // æ˜¾ç¤ºé€šçŸ¥
  
  // ç³»ç»Ÿæƒé™
  SYSTEM_COMMAND = 'system.command',   // æ‰§è¡Œç³»ç»Ÿå‘½ä»¤
  SYSTEM_PROCESS = 'system.process',   // åˆ›å»ºå­è¿›ç¨‹
  SYSTEM_CLIPBOARD = 'system.clipboard', // è®¿é—®å‰ªè´´æ¿
  
  // æ’ä»¶é—´é€šä¿¡
  IPC_SEND = 'ipc.send',               // å‘é€æ¶ˆæ¯
  IPC_RECEIVE = 'ipc.receive'          // æ¥æ”¶æ¶ˆæ¯
}

// æƒé™æ£€æŸ¥å™¨
interface PermissionChecker {
  hasPermission(pluginId: string, permission: PluginPermission): boolean
  requestPermission(pluginId: string, permission: PluginPermission): Promise<boolean>
  revokePermission(pluginId: string, permission: PluginPermission): void
}
```

### å®‰å…¨æ²™ç®±è®¾è®¡

```typescript
// æ²™ç®±ç¯å¢ƒæ¥å£
interface PluginSandbox {
  readonly pluginId: string
  readonly permissions: Set<PluginPermission>
  
  // å—é™çš„å…¨å±€å¯¹è±¡
  readonly global: PluginGlobal
  
  // APIä»£ç†
  readonly api: ProxiedAPI
  
  // èµ„æºç›‘æ§
  readonly monitor: ResourceMonitor
  
  // æ‰§è¡Œæ’ä»¶ä»£ç 
  execute(code: string, context?: any): Promise<any>
  
  // é”€æ¯æ²™ç®±
  destroy(): void
}

// å—é™çš„å…¨å±€å¯¹è±¡
interface PluginGlobal {
  // åŸºæœ¬JavaScriptå¯¹è±¡
  Object: typeof Object
  Array: typeof Array
  Promise: typeof Promise
  JSON: typeof JSON
  
  // ç¦æ­¢è®¿é—®çš„å¯¹è±¡
  // process: undefined
  // require: undefined
  // global: undefined
  // window: undefined
}

// èµ„æºç›‘æ§
interface ResourceMonitor {
  // CPUä½¿ç”¨ç‡
  getCpuUsage(): number
  
  // å†…å­˜ä½¿ç”¨é‡
  getMemoryUsage(): number
  
  // ç½‘ç»œè¯·æ±‚æ¬¡æ•°
  getNetworkRequests(): number
  
  // æ–‡ä»¶æ“ä½œæ¬¡æ•°
  getFileOperations(): number
  
  // è®¾ç½®èµ„æºé™åˆ¶
  setLimits(limits: ResourceLimits): void
}
```

---

## æ’ä»¶å¼€å‘æŒ‡å—

### 1. æ’ä»¶é¡¹ç›®ç»“æ„

```
my-plugin/
â”œâ”€â”€ package.json              # åŒ…ä¿¡æ¯å’Œä¾èµ–
â”œâ”€â”€ plugin.json              # æ’ä»¶æ¸…å•æ–‡ä»¶
â”œâ”€â”€ README.md                # æ’ä»¶è¯´æ˜
â”œâ”€â”€ CHANGELOG.md             # æ›´æ–°æ—¥å¿—
â”œâ”€â”€ src/                     # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ index.ts            # æ’ä»¶å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ commands/           # å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ ui/                 # UIç»„ä»¶
â”‚   â”œâ”€â”€ algorithms/         # ç®—æ³•å®ç°
â”‚   â””â”€â”€ utils/              # å·¥å…·å‡½æ•°
â”œâ”€â”€ assets/                  # é™æ€èµ„æº
â”‚   â”œâ”€â”€ icons/              # å›¾æ ‡æ–‡ä»¶
â”‚   â””â”€â”€ themes/             # ä¸»é¢˜æ–‡ä»¶
â”œâ”€â”€ tests/                   # æµ‹è¯•æ–‡ä»¶
â””â”€â”€ dist/                    # æ„å»ºè¾“å‡º
```

### 2. æ’ä»¶æ¸…å•æ–‡ä»¶ (plugin.json)

```json
{
  "id": "com.example.my-plugin",
  "name": "My Awesome Plugin",
  "version": "1.0.0",
  "description": "ä¸€ä¸ªå¼ºå¤§çš„MemoryNoteæ’ä»¶",
  "author": "Your Name <your.email@example.com>",
  "license": "MIT",
  "homepage": "https://github.com/yourname/my-plugin",
  "repository": "https://github.com/yourname/my-plugin.git",
  
  "engines": {
    "memorynote": "^1.0.0"
  },
  
  "main": "dist/index.js",
  
  "contributes": {
    "commands": [
      {
        "id": "my-plugin.hello-world",
        "title": "Hello World",
        "description": "æ˜¾ç¤ºHello Worldæ¶ˆæ¯"
      }
    ],
    
    "keybindings": [
      {
        "key": "Ctrl+Shift+H",
        "command": "my-plugin.hello-world",
        "when": "activeEditor"
      }
    ],
    
    "sidebar": [
      {
        "id": "my-plugin.sidebar",
        "title": "æˆ‘çš„å·¥å…·",
        "icon": "ğŸ”§",
        "component": "MySidebarComponent"
      }
    ],
    
    "algorithms": [
      {
        "type": "diff",
        "id": "my-plugin.semantic-diff",
        "name": "è¯­ä¹‰å·®å¼‚ç®—æ³•",
        "description": "åŸºäºè¯­ä¹‰åˆ†æçš„å·®å¼‚æ£€æµ‹"
      },
      {
        "type": "review", 
        "id": "my-plugin.advanced-sr",
        "name": "é«˜çº§é—´éš”é‡å¤",
        "description": "æ”¹è¿›çš„é—´éš”é‡å¤ç®—æ³•"
      }
    ]
  },
  
  "permissions": [
    "fs.read",
    "fs.write", 
    "db.read",
    "db.write",
    "ui.modify",
    "network.request"
  ],
  
  "configurationSchema": {
    "type": "object",
    "properties": {
      "enableAdvancedFeatures": {
        "type": "boolean",
        "default": false,
        "description": "å¯ç”¨é«˜çº§åŠŸèƒ½"
      },
      "algorithmSettings": {
        "type": "object",
        "properties": {
          "diffSensitivity": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "default": 0.5
          }
        }
      }
    }
  }
}
```

### 3. æ’ä»¶å…¥å£æ–‡ä»¶ç¤ºä¾‹

```typescript
// src/index.ts
import { Plugin, PluginContext } from '@memorynote/plugin-api'
import { HelloWorldCommand } from './commands/HelloWorldCommand'
import { MySidebarComponent } from './ui/MySidebarComponent'
import { SemanticDiffAlgorithm } from './algorithms/SemanticDiffAlgorithm'
import { AdvancedSRAlgorithm } from './algorithms/AdvancedSRAlgorithm'

export default class MyPlugin implements Plugin {
  private commands: HelloWorldCommand
  private diffAlgorithm: SemanticDiffAlgorithm
  private reviewAlgorithm: AdvancedSRAlgorithm
  
  constructor(public readonly context: PluginContext) {
    this.commands = new HelloWorldCommand(context)
    this.diffAlgorithm = new SemanticDiffAlgorithm(context)
    this.reviewAlgorithm = new AdvancedSRAlgorithm(context)
  }
  
  async onLoad(): Promise<void> {
    this.context.logger.info('æ’ä»¶å¼€å§‹åŠ è½½...')
  }
  
  async onActivate(): Promise<void> {
    this.context.logger.info('æ’ä»¶æ¿€æ´»ä¸­...')
    
    // æ³¨å†Œå‘½ä»¤
    this.commands.register()
    
    // æ³¨å†Œä¾§è¾¹æ é¢æ¿
    this.context.api.ui.sidebar.registerPanel({
      id: 'my-plugin.sidebar',
      title: 'æˆ‘çš„å·¥å…·',
      icon: 'ğŸ”§',
      component: MySidebarComponent,
      position: 100
    })
    
    // æ³¨å†Œå·®å¼‚ç®—æ³•
    this.context.api.data.diff.registerAlgorithm(this.diffAlgorithm)
    
    // æ³¨å†Œå¤ä¹ ç®—æ³•
    this.context.api.review.algorithms.register(this.reviewAlgorithm)
    
    // ç›‘å¬é…ç½®å˜åŒ–
    this.context.api.system.configuration.onDidChange((change) => {
      if (change.key.startsWith('my-plugin.')) {
        this.onConfigurationChanged(change)
      }
    })
    
    // ç›‘å¬æ–‡ä»¶å˜åŒ–é’©å­
    this.context.hooks.on('file.saved', this.onFileSaved.bind(this))
    
    this.context.logger.info('æ’ä»¶æ¿€æ´»å®Œæˆ')
  }
  
  async onDeactivate(): Promise<void> {
    this.context.logger.info('æ’ä»¶åœç”¨ä¸­...')
    // æ¸…ç†èµ„æº
    this.context.disposables.dispose()
  }
  
  async onUnload(): Promise<void> {
    this.context.logger.info('æ’ä»¶å¸è½½ä¸­...')
  }
  
  private async onFileSaved(context: any): Promise<void> {
    const { filePath, content } = context.data
    
    // å½“æ–‡ä»¶ä¿å­˜æ—¶ï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦åˆ›å»ºå¤ä¹ å¡ç‰‡
    if (filePath.endsWith('.md')) {
      await this.checkAndCreateReviewCards(filePath, content)
    }
  }
  
  private async checkAndCreateReviewCards(filePath: string, content: string): Promise<void> {
    // å®ç°å¤ä¹ å¡ç‰‡åˆ›å»ºé€»è¾‘
    // ä¾‹å¦‚ï¼šæ£€æµ‹æ–‡ä»¶ä¸­çš„å…³é”®çŸ¥è¯†ç‚¹ï¼Œè‡ªåŠ¨åˆ›å»ºå¤ä¹ å¡ç‰‡
  }
  
  private onConfigurationChanged(change: any): void {
    this.context.logger.info(`é…ç½®å·²æ›´æ”¹: ${change.key} = ${change.value}`)
    // æ ¹æ®é…ç½®å˜åŒ–è°ƒæ•´æ’ä»¶è¡Œä¸º
  }
}
```

### 4. å‘½ä»¤å®ç°ç¤ºä¾‹

```typescript
// src/commands/HelloWorldCommand.ts
import { PluginContext } from '@memorynote/plugin-api'

export class HelloWorldCommand {
  constructor(private context: PluginContext) {}
  
  register(): void {
    this.context.api.system.commands.register({
      id: 'my-plugin.hello-world',
      title: 'Hello World',
      handler: this.execute.bind(this)
    })
  }
  
  async execute(): Promise<void> {
    const message = 'Hello from My Plugin!'
    
    await this.context.api.ui.dialog.showInformation(
      message,
      'ç¡®å®š',
      'å–æ¶ˆ'
    )
    
    this.context.logger.info('Hello Worldå‘½ä»¤å·²æ‰§è¡Œ')
  }
}
```

### 5. æ„å»ºå’Œæ‰“åŒ…

```json
// package.json
{
  "name": "my-memorynote-plugin",
  "version": "1.0.0",
  "scripts": {
    "build": "tsc && webpack",
    "watch": "tsc -w",
    "test": "jest",
    "package": "mn-plugin pack",
    "publish": "mn-plugin publish"
  },
  "devDependencies": {
    "@memorynote/plugin-api": "^1.0.0",
    "@memorynote/plugin-dev-tools": "^1.0.0",
    "typescript": "^4.0.0",
    "webpack": "^5.0.0"
  }
}
```

---

## æ’ä»¶ç®¡ç†ç³»ç»Ÿ

### 1. æ’ä»¶ç®¡ç†å™¨å®ç°

```typescript
// src/services/PluginManager.ts
export class PluginManager {
  private plugins = new Map<string, LoadedPlugin>()
  private pluginConfigs = new Map<string, PluginConfig>()
  private dependencyGraph = new DependencyGraph()
  
  async loadPlugin(pluginPath: string): Promise<void> {
    try {
      // è¯»å–æ’ä»¶æ¸…å•
      const manifest = await this.readPluginManifest(pluginPath)
      
      // éªŒè¯æ’ä»¶
      this.validatePlugin(manifest)
      
      // æ£€æŸ¥ä¾èµ–
      await this.resolveDependencies(manifest)
      
      // åˆ›å»ºæ²™ç®±ç¯å¢ƒ
      const sandbox = this.createSandbox(manifest)
      
      // åŠ è½½æ’ä»¶ä»£ç 
      const pluginCode = await this.loadPluginCode(pluginPath)
      
      // åœ¨æ²™ç®±ä¸­æ‰§è¡Œæ’ä»¶
      const pluginInstance = await sandbox.execute(pluginCode)
      
      // åˆ›å»ºæ’ä»¶ä¸Šä¸‹æ–‡
      const context = this.createPluginContext(manifest, sandbox)
      
      // åˆå§‹åŒ–æ’ä»¶
      const plugin = new pluginInstance(context)
      
      // è°ƒç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
      await plugin.onLoad?.()
      
      // æ³¨å†Œæ’ä»¶
      this.plugins.set(manifest.id, {
        manifest,
        instance: plugin,
        context,
        sandbox,
        state: PluginState.LOADED
      })
      
      this.emit('plugin-loaded', { pluginId: manifest.id })
      
    } catch (error) {
      this.handlePluginError(manifest?.id || 'unknown', error)
    }
  }
  
  async activatePlugin(pluginId: string): Promise<void> {
    const plugin = this.plugins.get(pluginId)
    if (!plugin) {
      throw new Error(`Plugin ${pluginId} not found`)
    }
    
    if (plugin.state === PluginState.ACTIVE) {
      return // Already active
    }
    
    try {
      // æ¿€æ´»ä¾èµ–çš„æ’ä»¶
      await this.activateDependencies(plugin.manifest)
      
      // è°ƒç”¨æ¿€æ´»æ–¹æ³•
      await plugin.instance.onActivate?.()
      
      // æ›´æ–°çŠ¶æ€
      plugin.state = PluginState.ACTIVE
      
      this.emit('plugin-activated', { pluginId })
      
    } catch (error) {
      plugin.state = PluginState.ERROR
      this.handlePluginError(pluginId, error)
    }
  }
  
  async deactivatePlugin(pluginId: string): Promise<void> {
    const plugin = this.plugins.get(pluginId)
    if (!plugin || plugin.state !== PluginState.ACTIVE) {
      return
    }
    
    try {
      // æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–æ’ä»¶ä¾èµ–æ­¤æ’ä»¶
      const dependents = this.findDependentPlugins(pluginId)
      if (dependents.length > 0) {
        throw new Error(`Cannot deactivate plugin ${pluginId}: other plugins depend on it`)
      }
      
      // è°ƒç”¨åœç”¨æ–¹æ³•
      await plugin.instance.onDeactivate?.()
      
      // æ¸…ç†èµ„æº
      plugin.context.disposables.dispose()
      
      // æ›´æ–°çŠ¶æ€
      plugin.state = PluginState.INACTIVE
      
      this.emit('plugin-deactivated', { pluginId })
      
    } catch (error) {
      this.handlePluginError(pluginId, error)
    }
  }
  
  async unloadPlugin(pluginId: string): Promise<void> {
    const plugin = this.plugins.get(pluginId)
    if (!plugin) {
      return
    }
    
    try {
      // å…ˆåœç”¨æ’ä»¶
      if (plugin.state === PluginState.ACTIVE) {
        await this.deactivatePlugin(pluginId)
      }
      
      // è°ƒç”¨å¸è½½æ–¹æ³•
      await plugin.instance.onUnload?.()
      
      // é”€æ¯æ²™ç®±
      plugin.sandbox.destroy()
      
      // ä»æ³¨å†Œè¡¨ä¸­ç§»é™¤
      this.plugins.delete(pluginId)
      
      this.emit('plugin-unloaded', { pluginId })
      
    } catch (error) {
      this.handlePluginError(pluginId, error)
    }
  }
}
```

### 2. æ’ä»¶å‘ç°å’Œå®‰è£…

```typescript
// æ’ä»¶å¸‚åœºæ¥å£
interface PluginMarket {
  searchPlugins(query: string, filters?: PluginSearchFilters): Promise<PluginInfo[]>
  getPluginDetails(pluginId: string): Promise<PluginDetails>
  downloadPlugin(pluginId: string, version?: string): Promise<string>
  getPluginVersions(pluginId: string): Promise<PluginVersion[]>
  checkUpdates(installedPlugins: InstalledPlugin[]): Promise<PluginUpdate[]>
}

// æ’ä»¶å®‰è£…å™¨
class PluginInstaller {
  async installPlugin(source: string | PluginPackage): Promise<void> {
    let packagePath: string
    
    if (typeof source === 'string') {
      // ä»URLæˆ–æ–‡ä»¶è·¯å¾„å®‰è£…
      packagePath = await this.downloadPlugin(source)
    } else {
      // ä»æ’ä»¶åŒ…å®‰è£…
      packagePath = await this.extractPlugin(source)
    }
    
    // éªŒè¯æ’ä»¶åŒ…
    await this.validatePluginPackage(packagePath)
    
    // å®‰è£…åˆ°æ’ä»¶ç›®å½•
    const installPath = await this.installToDirectory(packagePath)
    
    // æ³¨å†Œæ’ä»¶
    await this.pluginManager.loadPlugin(installPath)
    
    // æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    await this.cleanup(packagePath)
  }
  
  async updatePlugin(pluginId: string, newVersion: string): Promise<void> {
    // å¤‡ä»½å½“å‰ç‰ˆæœ¬
    await this.backupPlugin(pluginId)
    
    try {
      // ä¸‹è½½æ–°ç‰ˆæœ¬
      const packagePath = await this.downloadPluginVersion(pluginId, newVersion)
      
      // å¸è½½æ—§ç‰ˆæœ¬
      await this.pluginManager.unloadPlugin(pluginId)
      
      // å®‰è£…æ–°ç‰ˆæœ¬
      await this.installPlugin(packagePath)
      
      // è°ƒç”¨æ›´æ–°é’©å­
      const plugin = this.pluginManager.getPlugin(pluginId)
      await plugin?.instance.onUpdate?.(plugin.manifest.version, newVersion)
      
    } catch (error) {
      // æ¢å¤å¤‡ä»½
      await this.restorePlugin(pluginId)
      throw error
    }
  }
  
  async uninstallPlugin(pluginId: string): Promise<void> {
    // å¸è½½æ’ä»¶
    await this.pluginManager.unloadPlugin(pluginId)
    
    // åˆ é™¤æ’ä»¶æ–‡ä»¶
    await this.removePluginFiles(pluginId)
    
    // æ¸…ç†é…ç½®
    await this.cleanupPluginConfig(pluginId)
  }
}
```

---

## å¼€å‘å·¥å…·å’Œè°ƒè¯•

### 1. æ’ä»¶å¼€å‘å·¥å…·

```typescript
// å¼€å‘æ¨¡å¼ä¸‹çš„çƒ­é‡è½½
class PluginDevTools {
  private watchers = new Map<string, FileWatcher>()
  
  enableHotReload(pluginId: string): void {
    const plugin = this.pluginManager.getPlugin(pluginId)
    if (!plugin) return
    
    const watcher = this.createFileWatcher(plugin.manifest.path)
    watcher.on('change', async () => {
      try {
        // é‡æ–°åŠ è½½æ’ä»¶
        await this.hotReloadPlugin(pluginId)
        this.showNotification('æ’ä»¶å·²é‡æ–°åŠ è½½', 'success')
      } catch (error) {
        this.showNotification(`é‡æ–°åŠ è½½å¤±è´¥: ${error.message}`, 'error')
      }
    })
    
    this.watchers.set(pluginId, watcher)
  }
  
  private async hotReloadPlugin(pluginId: string): Promise<void> {
    // ä¿å­˜å½“å‰çŠ¶æ€
    const currentState = await this.savePluginState(pluginId)
    
    // å¸è½½æ’ä»¶
    await this.pluginManager.unloadPlugin(pluginId)
    
    // é‡æ–°åŠ è½½æ’ä»¶
    const plugin = await this.pluginManager.loadPlugin(pluginId)
    
    // æ¢å¤çŠ¶æ€
    await this.restorePluginState(pluginId, currentState)
    
    // é‡æ–°æ¿€æ´»
    await this.pluginManager.activatePlugin(pluginId)
  }
}

// æ’ä»¶è°ƒè¯•å™¨
class PluginDebugger {
  private breakpoints = new Map<string, Breakpoint[]>()
  private debugSessions = new Map<string, DebugSession>()
  
  async attachDebugger(pluginId: string): Promise<DebugSession> {
    const plugin = this.pluginManager.getPlugin(pluginId)
    if (!plugin) {
      throw new Error(`Plugin ${pluginId} not found`)
    }
    
    // åˆ›å»ºè°ƒè¯•ä¼šè¯
    const session = new DebugSession(pluginId, plugin.sandbox)
    
    // æ³¨å…¥è°ƒè¯•ä»£ç 
    await this.injectDebugCode(plugin.sandbox)
    
    // è®¾ç½®æ–­ç‚¹
    const breakpoints = this.breakpoints.get(pluginId) || []
    await session.setBreakpoints(breakpoints)
    
    this.debugSessions.set(pluginId, session)
    return session
  }
  
  setBreakpoint(pluginId: string, file: string, line: number): void {
    const breakpoints = this.breakpoints.get(pluginId) || []
    breakpoints.push({ file, line, enabled: true })
    this.breakpoints.set(pluginId, breakpoints)
    
    // å¦‚æœè°ƒè¯•ä¼šè¯å·²ç»å­˜åœ¨ï¼Œç«‹å³è®¾ç½®æ–­ç‚¹
    const session = this.debugSessions.get(pluginId)
    if (session) {
      session.setBreakpoint({ file, line, enabled: true })
    }
  }
}
```

### 2. æ’ä»¶æµ‹è¯•æ¡†æ¶

```typescript
// æ’ä»¶æµ‹è¯•å·¥å…·
class PluginTestRunner {
  async runTests(pluginId: string, testFiles?: string[]): Promise<TestResult> {
    const plugin = this.pluginManager.getPlugin(pluginId)
    if (!plugin) {
      throw new Error(`Plugin ${pluginId} not found`)
    }
    
    // åˆ›å»ºæµ‹è¯•ç¯å¢ƒ
    const testEnv = await this.createTestEnvironment(plugin)
    
    // åŠ è½½æµ‹è¯•æ–‡ä»¶
    const tests = await this.loadTestFiles(plugin.manifest.path, testFiles)
    
    // è¿è¡Œæµ‹è¯•
    const results: TestResult[] = []
    for (const test of tests) {
      const result = await this.runSingleTest(test, testEnv)
      results.push(result)
    }
    
    // æ¸…ç†æµ‹è¯•ç¯å¢ƒ
    await this.cleanupTestEnvironment(testEnv)
    
    return this.aggregateResults(results)
  }
  
  private async createTestEnvironment(plugin: LoadedPlugin): Promise<TestEnvironment> {
    // åˆ›å»ºéš”ç¦»çš„æµ‹è¯•ç¯å¢ƒ
    const testSandbox = this.createTestSandbox(plugin.manifest)
    
    // æ¨¡æ‹ŸAPI
    const mockAPI = this.createMockAPI()
    
    // åˆ›å»ºæµ‹è¯•ä¸Šä¸‹æ–‡
    const testContext = this.createTestContext(plugin.manifest, mockAPI)
    
    return {
      sandbox: testSandbox,
      api: mockAPI,
      context: testContext
    }
  }
}

// æµ‹è¯•è¾…åŠ©å‡½æ•°
export class PluginTestHelpers {
  static async createMockEditor(content: string = ''): Promise<MockEditor> {
    return new MockEditor(content)
  }
  
  static async createMockReviewCard(overrides?: Partial<ReviewCard>): Promise<ReviewCard> {
    return {
      id: 'test-card-' + Math.random().toString(36).substr(2, 9),
      title: 'Test Card',
      content: 'Test content',
      algorithm: 'sm2',
      created: new Date(),
      nextReview: new Date(),
      ...overrides
    }
  }
  
  static async waitForHook(hookType: HookType, timeout: number = 5000): Promise<HookContext> {
    return new Promise((resolve, reject) => {
      const timer = setTimeout(() => {
        reject(new Error(`Hook ${hookType} not triggered within ${timeout}ms`))
      }, timeout)
      
      const handler = (context: HookContext) => {
        clearTimeout(timer)
        resolve(context)
      }
      
      // ä¸€æ¬¡æ€§ç›‘å¬å™¨
      this.hooks.once(hookType, handler)
    })
  }
}
```

---

## éƒ¨ç½²å’Œåˆ†å‘

### 1. æ’ä»¶æ‰“åŒ…æ ¼å¼

```typescript
// æ’ä»¶åŒ…ç»“æ„
interface PluginPackage {
  manifest: PluginManifest           // æ’ä»¶æ¸…å•
  code: string                       // ç¼–è¯‘åçš„ä»£ç 
  assets: Map<string, Buffer>        // é™æ€èµ„æº
  dependencies: PluginDependency[]   // ä¾èµ–åˆ—è¡¨
  signature: string                  // æ•°å­—ç­¾å
  checksum: string                   // æ ¡éªŒå’Œ
}

// æ‰“åŒ…å·¥å…·
class PluginPackager {
  async packagePlugin(pluginPath: string): Promise<Buffer> {
    // è¯»å–æ’ä»¶æ–‡ä»¶
    const manifest = await this.readManifest(pluginPath)
    const code = await this.compileCode(pluginPath)
    const assets = await this.collectAssets(pluginPath)
    const dependencies = await this.resolveDependencies(manifest)
    
    // åˆ›å»ºåŒ…
    const pkg: PluginPackage = {
      manifest,
      code,
      assets,
      dependencies,
      signature: await this.signPackage(manifest, code),
      checksum: this.calculateChecksum(code, assets)
    }
    
    // å‹ç¼©å¹¶è¿”å›
    return await this.compressPackage(pkg)
  }
  
  async unpackagePlugin(packageBuffer: Buffer): Promise<PluginPackage> {
    // è§£å‹ç¼©
    const pkg = await this.decompressPackage(packageBuffer)
    
    // éªŒè¯ç­¾å
    await this.verifySignature(pkg)
    
    // éªŒè¯æ ¡éªŒå’Œ
    this.verifyChecksum(pkg)
    
    return pkg
  }
}
```

### 2. æ’ä»¶åˆ†å‘å¹³å°

```typescript
// æ’ä»¶æ³¨å†Œè¡¨
interface PluginRegistry {
  publish(packageBuffer: Buffer, metadata: PublishMetadata): Promise<void>
  unpublish(pluginId: string, version: string): Promise<void>
  getPackage(pluginId: string, version?: string): Promise<Buffer>
  searchPackages(query: SearchQuery): Promise<PluginSearchResult[]>
  getMetadata(pluginId: string): Promise<PluginMetadata>
}

// è‡ªåŠ¨æ›´æ–°ç³»ç»Ÿ
class PluginUpdater {
  async checkForUpdates(): Promise<PluginUpdate[]> {
    const installedPlugins = await this.getInstalledPlugins()
    const updates: PluginUpdate[] = []
    
    for (const plugin of installedPlugins) {
      const latestVersion = await this.getLatestVersion(plugin.id)
      if (this.isNewerVersion(latestVersion, plugin.version)) {
        updates.push({
          pluginId: plugin.id,
          currentVersion: plugin.version,
          latestVersion,
          description: await this.getUpdateDescription(plugin.id, latestVersion)
        })
      }
    }
    
    return updates
  }
  
  async updateAll(updates: PluginUpdate[]): Promise<void> {
    for (const update of updates) {
      try {
        await this.updatePlugin(update.pluginId, update.latestVersion)
      } catch (error) {
        console.error(`Failed to update plugin ${update.pluginId}:`, error)
      }
    }
  }
}
```

---

## æ€»ç»“

æœ¬æ–‡æ¡£è¯¦ç»†è®¾è®¡äº†MemoryNoteçš„æ’ä»¶ç³»ç»Ÿæ¶æ„ï¼ŒåŒ…æ‹¬ï¼š

### æ ¸å¿ƒç‰¹æ€§
- **å¼ºå¤§çš„æ‰©å±•èƒ½åŠ›**: æ”¯æŒUIæ‰©å±•ã€ç®—æ³•æ›¿æ¢ã€åŠŸèƒ½å¢å¼ºç­‰
- **å®‰å…¨çš„æ²™ç®±ç¯å¢ƒ**: æƒé™æ§åˆ¶ã€èµ„æºéš”ç¦»ã€é”™è¯¯éš”ç¦»
- **å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†**: åŠ è½½ã€æ¿€æ´»ã€åœç”¨ã€å¸è½½ç­‰çŠ¶æ€ç®¡ç†
- **äº‹ä»¶é©±åŠ¨çš„é’©å­ç³»ç»Ÿ**: çµæ´»çš„æ‰©å±•ç‚¹æœºåˆ¶
- **ä¸°å¯Œçš„APIæ¥å£**: è¦†ç›–ç¼–è¾‘å™¨ã€æ•°æ®ã€UIã€ç³»ç»Ÿç­‰å„ä¸ªå±‚é¢

### å¼€å‘æ”¯æŒ
- **å®Œæ•´çš„å¼€å‘å·¥å…·é“¾**: çƒ­é‡è½½ã€è°ƒè¯•å™¨ã€æµ‹è¯•æ¡†æ¶
- **è¯¦ç»†çš„å¼€å‘æ–‡æ¡£**: APIæ–‡æ¡£ã€ç¤ºä¾‹ä»£ç ã€æœ€ä½³å®è·µ
- **æ ‡å‡†åŒ–çš„æ‰“åŒ…æ ¼å¼**: æ˜“äºåˆ†å‘å’Œå®‰è£…çš„æ’ä»¶åŒ…æ ¼å¼
- **è‡ªåŠ¨æ›´æ–°æœºåˆ¶**: æ’ä»¶çš„ç‰ˆæœ¬ç®¡ç†å’Œè‡ªåŠ¨æ›´æ–°

### æ‰©å±•åœºæ™¯
1. **UIæ‰©å±•**: ä¾§è¾¹æ é¢æ¿ã€å¯¼èˆªæŒ‰é’®ã€ç¼–è¾‘å™¨åŠŸèƒ½
2. **ç®—æ³•æ‰©å±•**: å·®å¼‚æ£€æµ‹ç®—æ³•ã€å¤ä¹ ç®—æ³•
3. **åŠŸèƒ½æ‰©å±•**: æ–°çš„å¤ä¹ æ¨¡å¼ã€æ•°æ®åŒæ­¥ã€ä¸»é¢˜å®šåˆ¶
4. **é›†æˆæ‰©å±•**: ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆã€å·¥å…·é“¾é›†æˆ

è¿™ä¸ªæ’ä»¶ç³»ç»Ÿè®¾è®¡ä¸ºMemoryNoteæä¾›äº†å¼ºå¤§çš„æ‰©å±•èƒ½åŠ›ï¼Œæ—¢ä¿è¯äº†æ ¸å¿ƒåŠŸèƒ½çš„ç¨³å®šæ€§ï¼Œåˆä¸ºæœªæ¥çš„åŠŸèƒ½æ‰©å±•é¢„ç•™äº†å……è¶³çš„ç©ºé—´ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡æ’ä»¶ç³»ç»Ÿè½»æ¾åœ°ä¸ºMemoryNoteæ·»åŠ æ–°åŠŸèƒ½ï¼Œè€Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©å®‰è£…ç›¸åº”çš„æ’ä»¶ã€‚

<function_calls>
<invoke name="todo_write">
<parameter name="merge">true
